import sys
from awsglue.transforms import *
from awsglue.utils import getResolvedOptions
from pyspark.context import SparkContext
from awsglue.context import GlueContext
from awsglue.job import Job
import re

args = getResolvedOptions(sys.argv, ["JOB_NAME"])
sc = SparkContext()
glueContext = GlueContext(sc)
spark = glueContext.spark_session
job = Job(glueContext)
job.init(args["JOB_NAME"], args)

# Script generated for node S3 bucket
S3bucket_node1 = glueContext.create_dynamic_frame.from_options(
    format_options={},
    connection_type="s3",
    format="parquet",
    connection_options={
        "paths": ["s3://coreprofile-entities/tire-profile/tire-profile-flattened/"],
        "recurse": True,
    },
    transformation_ctx="S3bucket_node1",
)

# Script generated for node Filter
Filter_node1664289580333 = Filter.apply(
    frame=S3bucket_node1,
    f=lambda row: (
        bool(re.match("3~.*", row["item_hash_key_s"]))
        and bool(re.match("v0_tire.*", row["item_range_key_s"]))
    ),
    transformation_ctx="Filter_node1664289580333",
)

# Script generated for node Select Fields
SelectFields_node1664289587397 = SelectFields.apply(
    frame=Filter_node1664289580333,
    paths=[
        "item_locations_l_sk",
        "item_axles_m_trailer_m_tire_replacement_priority_l_sk",
        "item_axles_m_trailer_m_pressure_sensor_m_types_l_sk",
        "item_axles_m_steer_m_tire_replacement_priority_l_sk",
        "item_axles_m_steer_m_pressure_sensor_m_types_l_sk",
        "item_axles_m_drive_m_tire_replacement_priority_l_sk",
        "item_brands_m_items_l_sk",
        "item_brands_ss_sk",
        "item_hash_key_s",
        "item_range_key_s",
        "item_customer_type_s",
        "item_update_user_s",
        "item_update_date_s",
        "item_update_date_n",
        "item_update_date_m_s_s",
        "item_created_date_s",
        "item_create_user_s",
        "item_current_version_n",
        "item_is_deleted_bool",
        "item_is_deleted_s",
        "item_tire_disposition_m_required_bool",
        "item_tire_disposition_m_stockable_bool",
        "item_vehicle_make_model_m_required_bool",
        "item_vehicle_make_model_m_stockable_bool",
        "item_vehicle_number_m_required_bool",
        "item_vehicle_number_m_stockable_bool",
        "item_vehicle_number_m_mask_s",
        "item_vehicle_odometer_reading_m_required_bool",
        "item_vehicle_odometer_reading_m_stockable_bool",
        "item_vehicle_tag_number_m_required_bool",
        "item_vehicle_tag_number_m_stockable_bool",
        "item_vehicle_type_m_required_bool",
        "item_vehicle_type_m_stockable_bool",
        "item_mspn_s",
        "item_company_s",
        "item_ld_na_number_s",
        "item_brands_m_require_flow_thru_caps_bool",
        "item_allow_bfgoodrich_tires_bool",
        "item_secondarytransportactivity_s",
        "item_home_office_name_null",
        "item_home_office_name_s",
        "item_fips_county_s",
        "item_fips_county_null",
        "item_phone_number_s",
        "item_action_code_s",
        "item_action_code_null",
        "item_cust_sub_chnl_code_s",
        "item_cust_chl_desc_s",
        "item_allow_michelin_tires_bool",
        "item_cust_bus_desc_s",
        "item_cust_bus_desc_null",
        "item_glo_code_desc_s",
        "item_glo_code_desc_null",
        "item_org_id_s",
        "item_org_id_null",
        "item_secondaryvocation_s",
        "item_customer_dba_name_null",
        "item_customer_dba_name_s",
        "item_cust_chnl_code_s",
        "item_allow_megamile_tires_bool",
        "item_cust_bus_code_s",
        "item_cust_bus_code_null",
        "item_hold_code_s",
        "item_hold_code_null",
        "item_cust_timezone_s",
        "item_cust_sub_chnl_desc_s",
        "item_cust_sub_chnl_desc_null",
        "item_profile_name_s",
        "item_assign_to_all_locations_bool",
        "item_bfg_promo_s",
        "item_michelin_promo_s",
        "item_bfgoodrich_tires_bool",
        "item_michelin_new_tires_bool",
        "item_uniroyal_tires_bool",
        "item_key_associate_dealer_bool",
        "item_county_s",
        "item_ers_247_flag_s",
        "item_ers_hours_of_operation_m_boxing_day_null",
        "item_ers_hours_of_operation_m_canada_day_null",
        "item_ers_hours_of_operation_m_christmas_day_null",
        "item_ers_hours_of_operation_m_christmas_eve_day_null",
        "item_ers_hours_of_operation_m_day_after_new_years_day_null",
        "item_ers_hours_of_operation_m_friday_null",
        "item_ers_hours_of_operation_m_good_friday_null",
        "item_ers_hours_of_operation_m_independence_day_null",
        "item_ers_hours_of_operation_m_jean_baptiste_day_null",
        "item_ers_hours_of_operation_m_labor_day_null",
        "item_ers_hours_of_operation_m_labour_day_null",
        "item_ers_hours_of_operation_m_memorial_day_null",
        "item_ers_hours_of_operation_m_monday_null",
        "item_ers_hours_of_operation_m_new_years_day_null",
        "item_ers_hours_of_operation_m_new_years_eve_day_null",
        "item_ers_hours_of_operation_m_ns_heritage_day_null",
        "item_ers_hours_of_operation_m_saturday_null",
        "item_ers_hours_of_operation_m_sunday_null",
        "item_ers_hours_of_operation_m_thanksgiving_day_null",
        "item_ers_hours_of_operation_m_thursday_null",
        "item_ers_hours_of_operation_m_tuesday_null",
        "item_ers_hours_of_operation_m_wednesday_null",
        "item_inter_hwy_info_s",
        "item_motor_coach_dealer_flag_bool",
        "item_phone_after_hours_s",
        "item_phone_toll_free_s",
        "item_rv_dealer_flag_bool",
        "item_secondary_phone_after_hours_s",
        "item_application_s",
        "item_profilename_s",
        "item_profiletype_s",
        "item_vehicletype_s",
        "item_tire_services_m_mounted_wheel_program_m_mobile_m_light_medium_duty_bool",
        "item_tire_services_m_mounted_wheel_program_m_mobile_m_heavy_duty_bool",
        "item_tire_services_m_mounted_wheel_program_m_in_bay_m_light_medium_duty_bool",
        "item_tire_services_m_mounted_wheel_program_m_in_bay_m_heavy_duty_bool",
        "item_tire_services_m_nail_hole_repair_m_mobile_m_light_medium_duty_bool",
        "item_tire_services_m_nail_hole_repair_m_mobile_m_heavy_duty_bool",
        "item_tire_services_m_nail_hole_repair_m_in_bay_m_light_medium_duty_bool",
        "item_tire_services_m_nail_hole_repair_m_in_bay_m_heavy_duty_bool",
        "item_tire_services_m_nail_hole_repair_bool",
        "item_tire_services_m_tia_certified_technicians_m_training_200_m_ats_bool",
        "item_tire_services_m_tia_certified_technicians_m_training_200_m_cts_bool",
        "item_tire_services_m_tia_certified_technicians_m_certificate_or_equivalent_300_m_ats_bool",
        "item_tire_services_m_tire_balancing_m_mobile_m_light_medium_duty_bool",
        "item_tire_services_m_tire_balancing_m_mobile_m_heavy_duty_bool",
        "item_tire_services_m_tire_balancing_m_in_bay_m_light_medium_duty_bool",
        "item_tire_services_m_tire_balancing_m_in_bay_m_heavy_duty_bool",
        "item_tire_services_m_tire_inspections_m_mobile_m_light_medium_duty_bool",
        "item_tire_services_m_tire_inspections_m_mobile_m_heavy_duty_bool",
        "item_tire_services_m_tire_inspections_m_in_bay_m_light_medium_duty_bool",
        "item_tire_services_m_tire_inspections_m_in_bay_m_heavy_duty_bool",
        "item_tire_services_m_tire_mounting_m_mobile_m_light_medium_duty_bool",
        "item_tire_services_m_tire_mounting_m_mobile_m_heavy_duty_bool",
        "item_tire_services_m_tire_mounting_m_in_bay_m_light_medium_duty_bool",
        "item_tire_services_m_tire_mounting_m_in_bay_m_heavy_duty_bool",
        "item_tire_services_m_tire_mounting_bool",
        "item_tire_services_m_tire_repairs_m_mobile_m_light_medium_duty_bool",
        "item_tire_services_m_tire_repairs_m_mobile_m_heavy_duty_bool",
        "item_tire_services_m_tire_repairs_m_in_bay_m_light_medium_duty_bool",
        "item_tire_services_m_tire_repairs_m_in_bay_m_heavy_duty_bool",
        "item_tire_services_m_tire_rotations_m_mobile_m_light_medium_duty_bool",
        "item_tire_services_m_tire_rotations_m_mobile_m_heavy_duty_bool",
        "item_tire_services_m_tire_rotations_m_in_bay_m_light_medium_duty_bool",
        "item_tire_services_m_tire_rotations_m_in_bay_m_heavy_duty_bool",
        "item_tire_services_m_towing_m_mobile_m_light_medium_duty_bool",
        "item_tire_services_m_towing_m_mobile_m_heavy_duty_bool",
        "item_tire_services_m_towing_bool",
        "item_tire_services_m_tpms_reset_and_replacement_m_mobile_m_light_medium_duty_bool",
        "item_tire_services_m_tpms_reset_and_replacement_m_mobile_m_heavy_duty_bool",
        "item_tire_services_m_tpms_reset_and_replacement_m_in_bay_m_light_medium_duty_bool",
        "item_tire_services_m_tpms_reset_and_replacement_m_in_bay_m_heavy_duty_bool",
        "item_tire_services_m_vehicle_alignment_m_mobile_m_light_medium_duty_bool",
        "item_tire_services_m_vehicle_alignment_m_mobile_m_heavy_duty_bool",
        "item_tire_services_m_vehicle_alignment_m_in_bay_m_light_medium_duty_bool",
        "item_tire_services_m_vehicle_alignment_m_in_bay_m_heavy_duty_bool",
        "item_tire_services_m_wheel_refurbishing_m_powder_coating_bool",
        "item_tire_services_m_wheel_refurbishing_m_polishing_bool",
        "item_tire_services_m_onsite_bool",
        "item_tire_services_m_truck_alignment_bool",
        "item_owner_type_s",
        "item_axles_m_drive_m_pressure_sensor_m_installed_bool",
        "item_axles_m_drive_m_tire_pressure_regulator_m_has_special_tools_bool",
        "item_axles_m_drive_m_tire_pressure_regulator_m_pressure_regulation_device_installed_bool",
        "item_axles_m_drive_m_tire_pressure_regulator_m_should_drive_be_reinstalled_bool",
        "item_axles_m_drive_m_tire_pressure_regulator_m_special_tools_bool",
        "item_axles_m_drive_m_tire_service_specifications_m_dual_tire_tread_depth_matching_s",
        "item_axles_m_drive_m_tire_service_specifications_m_requires_radio_runout_match_mounting_bool",
        "item_axles_m_steer_m_pressure_sensor_m_installed_bool",
        "item_axles_m_steer_m_tire_pressure_regulator_m_has_special_tools_bool",
        "item_axles_m_steer_m_tire_pressure_regulator_m_pressure_regulation_device_installed_bool",
        "item_axles_m_steer_m_tire_pressure_regulator_m_should_drive_be_reinstalled_bool",
        "item_axles_m_steer_m_tire_pressure_regulator_m_special_tools_bool",
        "item_axles_m_steer_m_tire_service_specifications_m_dual_tire_tread_depth_matching_s",
        "item_axles_m_steer_m_tire_service_specifications_m_requires_radio_runout_match_mounting_bool",
        "item_axles_m_trailer_m_pressure_sensor_m_installed_bool",
        "item_axles_m_trailer_m_tire_pressure_regulator_m_has_special_tools_bool",
        "item_axles_m_trailer_m_tire_pressure_regulator_m_pressure_regulation_device_installed_bool",
        "item_axles_m_trailer_m_tire_pressure_regulator_m_should_drive_be_reinstalled_bool",
        "item_axles_m_trailer_m_tire_pressure_regulator_m_special_tools_bool",
        "item_axles_m_trailer_m_tire_service_specifications_m_dual_tire_tread_depth_matching_s",
        "item_axles_m_trailer_m_tire_service_specifications_m_requires_radio_runout_match_mounting_bool",
        "item_main_m_application_type_s",
        "item_main_m_assign_to_all_locations_bool",
        "item_main_m_default_bool",
        "item_main_m_driver_can_override_bool",
        "item_main_m_off_tire_disposition_s",
        "item_main_m_profile_name_s",
        "item_main_m_profile_type_s",
        "item_main_m_single_call_indicator_bool",
        "item_main_m_vehicle_attrs_tractor_s",
        "item_main_m_vehicle_attrs_trailer_s",
        "item_main_m_vehicle_type_s",
        "item_main_m_vehicle_type_vmrs_code_s",
        "item_main_m_special_instructions_s",
        "item_additional_instructions_s",
        "item_profile_type_s",
        "item_owner_location_s",
        "item_brand_s",
        "item_tire_size_s",
        "item_tread_design_s",
        "item_load_range_null",
        "item_load_range_s",
        "item_original_tread_depth_s",
        "item_tire_type_s",
        "item_width_s",
        "item#0_gsi1_hash_key_s",
        "item#0_gsi1_range_key_s",
        "item#0_gsi2_hash_key_s",
        "item#0_gsi2_range_key_s",
        "item#0_gsi4_hash_key_s",
        "item#0_gsi4_range_key_s",
        "item#0_gsi5_hash_key_s",
        "item#0_gsi5_range_key_s",
        "item#0_gsi3_hash_key_s",
        "item#0_gsi3_range_key_s",
        "item#0_gsi6_hash_key_s",
        "item#0_gsi6_range_key_s",
        "lvl1",
        "m_id_n",
        "m_other_description_null",
        "m_other_description_s",
        "m_priority_n",
        "m_type_s",
        "m_brand_s",
        "m_key_s",
        "item_axles_m_drive_m_tire_replacement_priority_l_m_brand_s",
        "m_load_range_s",
        "m_mspn_s",
        "m_original_tire_depth_s",
        "item_axles_m_drive_m_tire_replacement_priority_l_m_priority_n",
        "m_tire_size_s",
        "m_tire_type_s",
        "m_tread_design_s",
        "m_note_s",
        "m_width_s",
        "m_original_tire_depth_null",
        "s",
        "item_axles_m_steer_m_tire_replacement_priority_l_m_brand_s",
        "item_axles_m_steer_m_tire_replacement_priority_l_m_mspn_s",
        "item_axles_m_steer_m_tire_replacement_priority_l_m_priority_n",
        "item_axles_m_steer_m_tire_replacement_priority_l_m_tire_type_s",
        "item_axles_m_steer_m_tire_replacement_priority_l_m_note_s",
        "item_axles_m_trailer_m_pressure_sensor_m_types_l_s",
        "item_axles_m_trailer_m_tire_replacement_priority_l_m_brand_s",
        "item_axles_m_trailer_m_tire_replacement_priority_l_m_mspn_s",
        "item_axles_m_trailer_m_tire_replacement_priority_l_m_priority_n",
        "item_axles_m_trailer_m_tire_replacement_priority_l_m_tire_type_s",
        "item_axles_m_trailer_m_tire_replacement_priority_l_m_note_s",
        "item_axles_m_trailer_m_tire_replacement_priority_l_m_original_tire_depth_null",
        "item_locations_l_s",
    ],
    transformation_ctx="SelectFields_node1664289587397",
)

# Script generated for node S3 bucket
S3bucket_node3 = glueContext.write_dynamic_frame.from_options(
    frame=SelectFields_node1664289587397,
    connection_type="s3",
    format="glueparquet",
    connection_options={
        "path": "s3://coreprofile-entities/tire-profile/tire-profile-filtered-hk-rk-select-fields/",
        "partitionKeys": [],
    },
    format_options={"compression": "snappy"},
    transformation_ctx="S3bucket_node3",
)

job.commit()
